{
  "@context": "https://schema.org",
  "@type": "Product",

  "_comment_identity": "=== PRODUCT IDENTITY (from CATALOG) ===",
  "name": "{{CATALOG:device.product.displayName}}",
  "description": "{{CATALOG:childSku.description}}",
  "url": "{{CATALOG:childSku.mPDPPageURL}}",
  "image": ["{{CATALOG:childSku.mediaTypes.images.masterImageUrl}}"],

  "_comment_identifiers": "=== PRODUCT IDENTIFIERS (from CATALOG) ===",
  "sku": "{{CATALOG:childSku.billingInfo.billCode}}",
  "gtin13": "{{CATALOG:childSku.upc}}",
  "mpn": "{{CATALOG:childSku.manufacturersPartNumber}}",

  "_comment_brand": "=== BRAND (from CATALOG) ===",
  "brand": {
    "@type": "Brand",
    "name": "{{CATALOG:device.product.manufacturer}}",
    "url": "{{STATIC:manufacturer_url}}"
  },
  "manufacturer": {
    "@type": "Organization",
    "name": "{{CATALOG:device.product.manufacturer}} Inc.",
    "url": "{{STATIC:manufacturer_url}}"
  },
  "model": "{{CATALOG:device.product.model}}",

  "_comment_attributes": "=== PRODUCT ATTRIBUTES ===",
  "color": "{{CATALOG:AGGREGATE(childSku[*].color)}}",
  "material": "{{CMS:keyFeatures[0].master.description|PARSE}}",
  "category": "{{CATALOG:device.product.subCategory}}",

  "_comment_dimensions": "=== DIMENSIONS (from CMS DIM-*) ===",
  "weight": {
    "@type": "QuantitativeValue",
    "value": "{{CMS:DIM-20.value|PARSE_FLOAT}}",
    "unitCode": "ONZ",
    "unitText": "ounces"
  },
  "height": {
    "@type": "QuantitativeValue",
    "value": "{{CMS:DIM-10.value|PARSE_DIM[0]}}",
    "unitCode": "INH",
    "unitText": "inches"
  },
  "width": {
    "@type": "QuantitativeValue",
    "value": "{{CMS:DIM-10.value|PARSE_DIM[1]}}",
    "unitCode": "INH",
    "unitText": "inches"
  },
  "depth": {
    "@type": "QuantitativeValue",
    "value": "{{CMS:DIM-10.value|PARSE_DIM[2]}}",
    "unitCode": "INH",
    "unitText": "inches"
  },

  "_comment_rating": "=== AGGREGATE RATING (from CATALOG) ===",
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "{{CATALOG:childSku.reviewRatings.starRating|ROUND(1)}}",
    "bestRating": 5,
    "worstRating": 1,
    "ratingCount": "{{CATALOG:childSku.reviewRatings.reviewCount}}",
    "reviewCount": "{{CATALOG:childSku.reviewRatings.reviewCount}}"
  },

  "_comment_offers": "=== OFFERS (from CATALOG) ===",
  "offers": {
    "@type": "AggregateOffer",
    "url": "{{CATALOG:childSku.mPDPPageURL}}",
    "priceCurrency": "USD",
    "lowPrice": "{{CATALOG:MIN(childSku[*].price.price.msrp)}}",
    "highPrice": "{{CATALOG:MAX(childSku[*].price.price.msrp)}}",
    "offerCount": "{{CATALOG:COUNT(DISTINCT(childSku[*].storage))}}",
    "availability": "{{CATALOG:childSku.saleStatus|MAP_AVAILABILITY}}",
    "itemCondition": "{{CATALOG:childSku.condition.key|MAP_CONDITION}}",
    "priceValidUntil": "{{STATIC:price_valid_until}}",

    "seller": {
      "@type": "Organization",
      "name": "AT&T",
      "url": "https://www.att.com",
      "telephone": "+1-800-331-0500"
    },

    "_comment_variants": "=== VARIANT OFFERS - Loop through childSkus ===",
    "offers": [
      {
        "@type": "Offer",
        "_for_each": "{{CATALOG:childSku[]}}",
        "name": "{{CATALOG:childSku.displayName|PARSE_VARIANT_NAME}}",
        "sku": "{{CATALOG:childSku.skuId}}",
        "price": "{{CATALOG:childSku.price.price.msrp}}",
        "priceCurrency": "USD",
        "availability": "{{CATALOG:childSku.saleStatus|MAP_AVAILABILITY}}",
        "itemCondition": "{{CATALOG:childSku.condition.key|MAP_CONDITION}}",
        "priceSpecification": {
          "@type": "UnitPriceSpecification",
          "price": "{{CATALOG:childSku.price.price.listPrice}}",
          "priceCurrency": "USD",
          "unitText": "monthly",
          "referenceQuantity": {
            "@type": "QuantitativeValue",
            "value": "{{CATALOG:childSku.price.price.termLength}}",
            "unitCode": "MON"
          },
          "description": "{{CATALOG:childSku.price.price.termLength}}-month installment plan at 0% APR"
        },
        "itemOffered": {
          "@type": "Product",
          "name": "{{CATALOG:childSku.displayName|PARSE_VARIANT_NAME}}",
          "additionalProperty": {
            "@type": "PropertyValue",
            "name": "Storage Capacity",
            "value": "{{CATALOG:childSku.displayName|PARSE_STORAGE_VALUE}}",
            "unitCode": "{{CATALOG:childSku.displayName|PARSE_STORAGE_UNIT_CODE}}",
            "unitText": "{{CATALOG:childSku.displayName|PARSE_STORAGE_UNIT}}"
          }
        }
      }
    ],

    "shippingDetails": {
      "@type": "OfferShippingDetails",
      "shippingRate": {
        "@type": "MonetaryAmount",
        "value": 0,
        "currency": "USD"
      },
      "shippingDestination": {
        "@type": "DefinedRegion",
        "addressCountry": "US"
      }
    },

    "hasMerchantReturnPolicy": {
      "@type": "MerchantReturnPolicy",
      "applicableCountry": "US",
      "returnPolicyCategory": "https://schema.org/MerchantReturnFiniteReturnWindow",
      "merchantReturnDays": 14,
      "returnMethod": "https://schema.org/ReturnByMail",
      "returnFees": "https://schema.org/FreeReturn"
    }
  },

  "_comment_specs": "=== ADDITIONAL PROPERTIES (from CMS deviceSpecification) ===",
  "additionalProperty": [
    {
      "@type": "PropertyValue",
      "propertyID": "display-diagonal",
      "name": "Display Diagonal",
      "_source": "CMS:DIS-10",
      "value": {
        "@type": "QuantitativeValue",
        "value": "{{CMS:DIS-10.value|PARSE_INCHES}}",
        "unitCode": "INH",
        "unitText": "inches (diagonal)"
      }
    },
    {
      "@type": "PropertyValue",
      "propertyID": "display-resolution-width",
      "name": "Resolution Width",
      "_source": "CMS:DIS-20",
      "value": {
        "@type": "QuantitativeValue",
        "value": "{{CMS:DIS-20.value|PARSE_RESOLUTION[0]}}",
        "unitText": "pixels"
      }
    },
    {
      "@type": "PropertyValue",
      "propertyID": "display-resolution-height",
      "name": "Resolution Height",
      "_source": "CMS:DIS-20",
      "value": {
        "@type": "QuantitativeValue",
        "value": "{{CMS:DIS-20.value|PARSE_RESOLUTION[1]}}",
        "unitText": "pixels"
      }
    },
    {
      "@type": "PropertyValue",
      "propertyID": "display-ppi",
      "name": "Pixel Density (PPI)",
      "_source": "CMS:DIS-20",
      "value": {
        "@type": "QuantitativeValue",
        "value": "{{CMS:DIS-20.value|PARSE_PPI}}",
        "unitText": "ppi"
      }
    },
    {
      "@type": "PropertyValue",
      "propertyID": "display-type",
      "name": "Display Type",
      "_source": "CMS:DIS-40",
      "value": "{{CMS:DIS-40.key}}"
    },
    {
      "@type": "PropertyValue",
      "propertyID": "water-resistance",
      "name": "Water Resistance",
      "_source": "CMS:DIS-60",
      "value": "{{CMS:DIS-60.value|STRIP_HTML}}"
    },
    {
      "@type": "PropertyValue",
      "propertyID": "camera-main",
      "name": "Main Camera",
      "_source": "CMS:CAM-10",
      "value": "{{CMS:CAM-10.value|STRIP_HTML|FIRST_LINE}}"
    },
    {
      "@type": "PropertyValue",
      "propertyID": "camera-zoom",
      "name": "Zoom",
      "_source": "CMS:CAM-70",
      "value": "{{CMS:CAM-70.value|STRIP_HTML}}"
    },
    {
      "@type": "PropertyValue",
      "propertyID": "camera-front",
      "name": "Front Camera",
      "_source": "CMS:CAM-60",
      "value": "{{CMS:CAM-60.value|STRIP_HTML|FIRST_LINE}}"
    },
    {
      "@type": "PropertyValue",
      "propertyID": "video-recording",
      "name": "Video Recording",
      "_source": "CMS:CAM-20",
      "value": "{{CMS:CAM-20.value|STRIP_HTML|FIRST_LINE}}"
    },
    {
      "@type": "PropertyValue",
      "propertyID": "battery-video-playback",
      "name": "Video Playback",
      "_source": "CMS:BAT-50",
      "value": "{{CMS:BAT-50.value|STRIP_HTML}}"
    },
    {
      "@type": "PropertyValue",
      "propertyID": "battery-charging",
      "name": "Fast Charging",
      "_source": "CMS:BAT-180",
      "value": "{{CMS:BAT-180.value|STRIP_HTML}}"
    },
    {
      "@type": "PropertyValue",
      "propertyID": "wireless-charging",
      "name": "Wireless Charging",
      "_source": "CMS:BAT-80",
      "value": "{{CMS:BAT-80.value|STRIP_HTML|FIRST_LINE}}"
    },
    {
      "@type": "PropertyValue",
      "propertyID": "processor",
      "name": "Processor",
      "_source": "CMS:PRO-10",
      "value": "{{CMS:PRO-10.value|STRIP_HTML}}"
    },
    {
      "@type": "PropertyValue",
      "propertyID": "storage-options",
      "name": "Storage Options",
      "_source": "CMS:MEM-10",
      "value": "{{CMS:MEM-10.value|STRIP_HTML}}"
    },
    {
      "@type": "PropertyValue",
      "propertyID": "operating-system",
      "name": "Operating System",
      "_source": "CMS:OPS-10",
      "value": "iOS {{CMS:OPS-10.value|STRIP_HTML}}"
    },
    {
      "@type": "PropertyValue",
      "propertyID": "5g-bands",
      "name": "5G Bands",
      "_source": "CMS:WLS-20",
      "value": "{{CMS:WLS-20.value|STRIP_HTML}}"
    },
    {
      "@type": "PropertyValue",
      "propertyID": "wifi",
      "name": "Wi-Fi",
      "_source": "CMS:WLS-110",
      "value": "{{CMS:WLS-110.value|STRIP_HTML}}"
    },
    {
      "@type": "PropertyValue",
      "propertyID": "bluetooth",
      "name": "Bluetooth",
      "_source": "CMS:WLS-140",
      "value": "{{CMS:WLS-140.value}}"
    },
    {
      "@type": "PropertyValue",
      "propertyID": "sim-type",
      "name": "SIM Type",
      "_source": "CMS:WLS-180",
      "value": "{{CMS:WLS-180.value|STRIP_HTML|FIRST_LINE}}"
    }
  ],

  "_comment_features": "=== KEY FEATURES (from CMS keyFeatures) ===",
  "subjectOf": {
    "@type": "ItemList",
    "name": "Key Features",
    "numberOfItems": "{{CMS:COUNT(keyFeatures)}}",
    "itemListElement": [
      {
        "@type": "ListItem",
        "_for_each": "{{CMS:keyFeatures[]}}",
        "position": "{{INDEX + 1}}",
        "name": "{{CMS:keyFeatures[INDEX].master.attributeID}}",
        "description": "{{CMS:keyFeatures[INDEX].master.description|STRIP_HTML}}"
      }
    ]
  }
}
